{"version":3,"file":"favorites.js","sources":["../src/js/favorites.js"],"sourcesContent":["const messageContainer = document.getElementById('message-container'); // to select message container\r\nlet currentCategory = 'All Categories';\r\nlet previousSelectedButton = null;\r\n\r\n// to fetch ids from local storage\r\nfunction getFavoriteIds() {\r\n    const favArrString = localStorage.getItem('favArr');\r\n    let favArr = [];\r\n    // to fetch favArr from local storage\r\n    try {\r\n        favArr = favArrString ? JSON.parse(favArrString) : [];\r\n    } catch (error) {\r\n        console.error('Error parsing favArr from localStorage:', error);\r\n        favArr = [];  // if favoriteIds turns null then return an empty array\r\n    }\r\n\r\n    const favoriteCards = document.querySelector('.favorite-cards');\r\n\r\n    if (favoriteCards) {\r\n        favoriteCards.innerHTML = \"\"; // clean all messages in message container\r\n    }\r\n\r\n    if (favArr.length === 0) {\r\n        messageContainer.innerHTML = `\r\n        <div class=\"fav-message-container\">\r\n            <img src=\"./img/raccoon-sad-fav.png\" class=\"fav-raccoon\">\r\n            <p class=\"fav-message\">It appears that you haven't added any recipes to your favorites yet. To get started, you can add recipes that you like to your favorites for easier access in the future.</p>\r\n            <img src=\"./img/raccoon-sad-fav.png\" class=\"fav-chefs-hat\">\r\n        </div>\r\n        `;\r\n    }\r\n    return favArr;\r\n}\r\n\r\n// async function to fetch data \r\nasync function fetchById(id) {\r\n    try {\r\n        const response = await fetch(`https://tasty-treats-backend.p.goit.global/api/recipes/${id}`);\r\n        if (!response.ok) {\r\n            throw new Error('Network response was not ok');\r\n        }\r\n        const recipe = await response.json();\r\n        localStorage.setItem(`recipe_${id}`, JSON.stringify(recipe)); // Store the recipe in local storage\r\n        return recipe;\r\n    } catch (error) {\r\n        console.error('Error fetching recipe by ID:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// to fetch all recipes that user selected as favorite\r\nasync function fetchFavorites() {\r\n    const favoriteIds = getFavoriteIds(); // get ids from local storage\r\n    try {\r\n        const recipes = await Promise.all(favoriteIds.map(id => fetchById(id))); // use these ids to fetch recipes from api. Promise.all means makes all api requests in parallel AND brings together into the results\r\n        return recipes.filter(recipe => recipe !== null); // return all recipes in array, filter out null values\r\n    } catch (error) {\r\n        console.error('Error fetching favorite recipes:', error);\r\n        return []; // Return an empty array if there is an error\r\n    }\r\n}\r\n\r\n// to display recipes \r\nasync function renderFavoriteRecipes() {\r\n    const recipes = await fetchFavorites();\r\n\r\n    if (recipes.length === 0) {\r\n        // Display a message if no favorite recipes are found\r\n    } else {\r\n        // Extract categories from recipes and store in local storage\r\n        const categories = [...new Set(recipes.map(recipe => recipe.category))];\r\n        localStorage.setItem('favArrCategory', JSON.stringify(categories));\r\n\r\n        renderCategoryNames();\r\n        renderRecipes(recipes);\r\n    }\r\n}\r\n\r\nfunction favoritesHeartBtn() {\r\n    const likeButtons = document.querySelectorAll('.heard-button');\r\n    likeButtons.forEach(button => {\r\n        button.addEventListener('click', function () {\r\n            const recipeId = button.dataset.id;\r\n            const recipeCategory = button.dataset.category;\r\n            const favArrString = localStorage.getItem('favArr');\r\n            let favArr = favArrString ? JSON.parse(favArrString) : [];\r\n\r\n            if (favArr.includes(recipeId)) {\r\n                favArr.splice(favArr.indexOf(recipeId), 1);\r\n                localStorage.setItem('favArr', JSON.stringify(favArr));\r\n            }\r\n\r\n            // Check if there are any remaining recipes of the same category\r\n            const remainingRecipes = favArr.filter(id => {\r\n                const recipe = JSON.parse(localStorage.getItem(`recipe_${id}`));\r\n                return recipe && recipe.category === recipeCategory;\r\n            });\r\n\r\n            if (remainingRecipes.length === 0) {\r\n                const favArrCategoryString = localStorage.getItem('favArrCategory');\r\n                let favArrCategory = favArrCategoryString ? JSON.parse(favArrCategoryString) : [];\r\n\r\n                if (favArrCategory.includes(recipeCategory)) {\r\n                    favArrCategory.splice(favArrCategory.indexOf(recipeCategory), 1);\r\n                    localStorage.setItem('favArrCategory', JSON.stringify(favArrCategory));\r\n                }\r\n            }\r\n\r\n            renderCategoryNames();\r\n            if (currentCategory === 'All Categories') {\r\n                renderFavoriteRecipes();\r\n            } else {\r\n                filterRecipesByCategory(currentCategory);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction addHeartButtonListeners() {\r\n    const likeButtons = document.querySelectorAll('.heard-button');\r\n    let favCategoryArr = [];\r\n    likeButtons.forEach(button => {\r\n        if (!favCategoryArr.includes(button.dataset.category)) {\r\n            favCategoryArr.push(button.dataset.category);\r\n        }\r\n    });\r\n    favCategoryArr.sort();\r\n}\r\n\r\nfunction renderCategoryNames() {\r\n    const favCategoriesList = document.querySelector('.fav-categories-list');\r\n    const favArrCategoryString = localStorage.getItem('favArrCategory');\r\n    let favArrCategory = favArrCategoryString ? JSON.parse(favArrCategoryString) : [];\r\n    favCategoriesList.innerHTML = '';\r\n\r\n    const allCategoriesLi = document.createElement('li');\r\n    const allCategoriesButton = document.createElement('button');\r\n    allCategoriesButton.textContent = 'All Categories';\r\n    allCategoriesButton.classList.add('category-button');\r\n    allCategoriesButton.addEventListener('click', () => {\r\n        currentCategory = 'All Categories';\r\n        if (previousSelectedButton) {\r\n            previousSelectedButton.style.backgroundColor = '';\r\n            previousSelectedButton.style.color = '';\r\n            previousSelectedButton.style.border = '';\r\n        }\r\n        allCategoriesButton.style.backgroundColor = 'var(--primary-color)';\r\n        allCategoriesButton.style.color = '#fff';\r\n        allCategoriesButton.style.border = '1px solid var(--primary-color)';\r\n        previousSelectedButton = allCategoriesButton;\r\n        renderFavoriteRecipes();\r\n    });\r\n    allCategoriesLi.appendChild(allCategoriesButton);\r\n    favCategoriesList.appendChild(allCategoriesLi);\r\n\r\n    favArrCategory.forEach(category => {\r\n        const li = document.createElement('li');\r\n        const button = document.createElement('button');\r\n        button.textContent = category;\r\n        button.classList.add('category-button');\r\n        button.addEventListener('click', () => {\r\n            currentCategory = category;\r\n            if (previousSelectedButton) {\r\n                previousSelectedButton.style.backgroundColor = '';\r\n                previousSelectedButton.style.color = '';\r\n                previousSelectedButton.style.border = '';\r\n            }\r\n            button.style.backgroundColor = 'var(--primary-color)';\r\n            button.style.color = '#fff';\r\n            button.style.border = '1px solid var(--primary-color)';\r\n            previousSelectedButton = button;\r\n            filterRecipesByCategory(category);\r\n        });\r\n        li.appendChild(button);\r\n        favCategoriesList.appendChild(li);\r\n    });\r\n}\r\n\r\nfunction filterRecipesByCategory(category) {\r\n    fetchFavorites().then(recipes => {\r\n        const filteredRecipes = recipes.filter(recipe => recipe.category === category);\r\n        renderRecipes(filteredRecipes);\r\n    });\r\n}\r\n\r\nfunction renderRecipes(recipes) {\r\n    const favoriteCards = document.querySelector('.favorite-cards');\r\n    favoriteCards.innerHTML = '';\r\n\r\n    recipes.forEach(recipe => {\r\n        const filledStars = Math.round(recipe.rating);\r\n        const emptyStars = 5 - filledStars;\r\n        const cardHTML = `\r\n        <li class=\"cards-listing\" style=\"background-image: url(${recipe.preview});\">\r\n            <button class=\"heard-button\" data-category=\"${recipe.category}\" data-id=\"${recipe._id}\" aria-label=\"like-btn\">\r\n                <svg class=\"svg-heard add-to-fav\" data-id=\"${recipe._id}\" width=\"22px\" height=\"22px\">\r\n                    <use href=\"./svg/sprite.svg#icon-heart-filled\"></use>\r\n                </svg>\r\n            </button>\r\n            <div class=\"card-content-container\">\r\n                <div class=\"text-container\">\r\n                    <h3 class=\"card-title\">${recipe.title}</h3>\r\n                    <p class=\"specification-text\">${recipe.description}</p>\r\n                </div>\r\n                <div class=\"card-rating-container\">\r\n                    <div class=\"rating-container\">\r\n                        <p class=\"rating-text\">${recipe.rating.toFixed(1)}</p>\r\n                        <div class=\"star-container\">\r\n                            ${`<svg class=\"card-star-svg\">\r\n                            <use href=\"./svg/sprite.svg#icon-star\"></use>\r\n                            </svg>`.repeat(filledStars)}\r\n                            ${`<svg class=\"card-star-svg\">\r\n                            <use href=\"./svg/sprite.svg#icon-emptystar\"></use>\r\n                            </svg>`.repeat(emptyStars)}\r\n                        </div>    \r\n                    </div>\r\n                    <button class=\"recipe-button\" data-id=\"${recipe._id}\">See recipe</button>\r\n                </div>      \r\n            </div>\r\n        </li>\r\n        `;\r\n        favoriteCards.innerHTML += cardHTML;\r\n    });\r\n\r\n    favoritesHeartBtn();\r\n    addHeartButtonListeners();\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', renderFavoriteRecipes);"],"names":["messageContainer","currentCategory","previousSelectedButton","getFavoriteIds","favArrString","favArr","error","favoriteCards","fetchById","id","response","recipe","fetchFavorites","favoriteIds","renderFavoriteRecipes","recipes","categories","renderCategoryNames","renderRecipes","favoritesHeartBtn","button","recipeId","recipeCategory","favArrCategoryString","favArrCategory","filterRecipesByCategory","addHeartButtonListeners","likeButtons","favCategoryArr","favCategoriesList","allCategoriesLi","allCategoriesButton","category","li","filteredRecipes","filledStars","emptyStars","cardHTML"],"mappings":"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"}